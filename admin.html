<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkmate Admin - æ´»å‹•ç®¡ç†</title>
    <link rel="stylesheet" href="css/token.css" />
    <link rel="stylesheet" href="css/admin.css" />
  </head>
  <body>
    <div id="admin-root">
      <div class="admin-container">
        <div class="admin-sidebar">
          <div class="admin-header">
            <h1>Checkmate ç®¡ç†</h1>
            <button class="publish-btn" id="publish-btn">ç™¼å¸ƒ</button>
          </div>
          
          <div class="links-section">
            <h3>åˆ†äº«é€£çµ</h3>
            <div class="link-item">
              <div class="link-info">
                <strong>ç”¨æˆ¶é€£çµ</strong><br>
                <small>çµ¦åœ˜éšŠæˆå“¡ä½¿ç”¨</small>
              </div>
              <button class="copy-btn" onclick="copyUserLink()">è¤‡è£½</button>
            </div>
            <div class="link-item">
              <div class="link-info">
                <strong>ç®¡ç†é€£çµ</strong><br>
                <small>ç·¨è¼¯å¾Œå°</small>
              </div>
              <button class="copy-btn" onclick="copyAdminLink()">è¤‡è£½</button>
            </div>
          </div>
          
          <div class="section-list">
            <div class="section-item" data-section="title">
              <div class="section-info">
                <span class="section-icon">ğŸ“</span>
                <span class="section-name">æ¨™é¡Œè¨­å®š</span>
              </div>
              <span class="section-toggle">ğŸ‘ï¸</span>
            </div>
            <div class="section-item" data-section="countdown">
              <div class="section-info">
                <span class="section-icon">â°</span>
                <span class="section-name">å€’æ•¸è¨ˆæ™‚</span>
              </div>
              <span class="section-toggle">ğŸ‘ï¸</span>
            </div>
            <div class="section-item" data-section="schedule">
              <div class="section-info">
                <span class="section-icon">ğŸ“…</span>
                <span class="section-name">è¡Œç¨‹å®‰æ’</span>
              </div>
              <span class="section-toggle">ğŸ‘ï¸</span>
            </div>
            <div class="section-item" data-section="packing">
              <div class="section-info">
                <span class="section-icon">ğŸ“¦</span>
                <span class="section-name">æ‰“åŒ…æ¸…å–®</span>
              </div>
              <span class="section-toggle">ğŸ‘ï¸</span>
            </div>
          </div>
        </div>
        
        <div class="admin-preview">
          <h2>é è¦½</h2>
          <div class="preview-phone">
            <div class="preview-content">
              <div class="preview-header">
                <h1 id="preview-title">Trip</h1>
                <div id="preview-subtitle">2025</div>
              </div>
              
              <div class="preview-countdown">
                <div class="countdown-date" id="preview-date">March 15th-16th, 2025</div>
                <div class="countdown-numbers">
                  <div class="countdown-item">
                    <div class="number">03</div>
                    <div class="label">Days</div>
                  </div>
                  <div class="countdown-item">
                    <div class="number">13</div>
                    <div class="label">Hours</div>
                  </div>
                  <div class="countdown-item">
                    <div class="number">30</div>
                    <div class="label">Minutes</div>
                  </div>
                  <div class="countdown-item">
                    <div class="number">58</div>
                    <div class="label">Seconds</div>
                  </div>
                </div>
              </div>
              
              <div class="preview-schedule">
                <h3>Schedule</h3>
                <div id="schedule-preview">
                  <div class="empty-state">No Schedule yet</div>
                </div>
              </div>
              
              <div class="preview-packing">
                <h3>Packing list</h3>
                <div id="packing-preview">
                  <div class="empty-state">No items yet</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-overlay" id="modal-overlay" style="display: none;">
        <div class="modal-content" id="modal-content"></div>
      </div>
    </div>

    <script type="module" src="js/firebase-config.js"></script>
    <script>
      let appSettings = {
        title: "Trip",
        subtitle: "2025",
        dateFrom: "2025-03-15T11:30",
        dateTo: "2025-03-16T15:00",
        schedule: []
      };

      const roomId = new URLSearchParams(window.location.search).get('room') || 'demo-room-' + Date.now();

      // åˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', function() {
        setupEventListeners();
        updatePreview();
      });

      function setupEventListeners() {
        // å€å¡Šé»æ“Šäº‹ä»¶
        document.addEventListener('click', function(e) {
          if (e.target.closest('.section-item')) {
            const section = e.target.closest('.section-item').dataset.section;
            openModal(section);
          }
          
          if (e.target.matches('.modal-overlay') || e.target.matches('.modal-close')) {
            closeModal();
          }
        });

        // ç™¼å¸ƒæŒ‰éˆ•
        document.getElementById('publish-btn').addEventListener('click', publishChanges);
      }

      function openModal(section) {
        const modal = document.getElementById('modal-overlay');
        const content = document.getElementById('modal-content');
        
        content.innerHTML = getModalContent(section);
        modal.style.display = 'flex';
        
        bindModalEvents(section);
      }

      function closeModal() {
        document.getElementById('modal-overlay').style.display = 'none';
      }

      function getModalContent(section) {
        switch(section) {
          case 'title':
            return `
              <div class="modal-header">
                <h3>æ¨™é¡Œè¨­å®š</h3>
                <button class="modal-close">Ã—</button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label>ä¸»æ¨™é¡Œ</label>
                  <input type="text" id="title-input" value="${appSettings.title}" placeholder="è¼¸å…¥ä¸»æ¨™é¡Œ">
                </div>
                <div class="form-group">
                  <label>å‰¯æ¨™é¡Œ</label>
                  <input type="text" id="subtitle-input" value="${appSettings.subtitle}" placeholder="è¼¸å…¥å‰¯æ¨™é¡Œ">
                </div>
              </div>
              <div class="modal-footer">
                <button class="save-btn" onclick="saveTitleSettings()">å„²å­˜</button>
              </div>
            `;
            
          case 'countdown':
            return `
              <div class="modal-header">
                <h3>å€’æ•¸è¨ˆæ™‚è¨­å®š</h3>
                <button class="modal-close">Ã—</button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label>é–‹å§‹æ™‚é–“</label>
                  <input type="datetime-local" id="date-from" value="${appSettings.dateFrom}">
                </div>
                <div class="form-group">
                  <label>çµæŸæ™‚é–“</label>
                  <input type="datetime-local" id="date-to" value="${appSettings.dateTo}">
                </div>
              </div>
              <div class="modal-footer">
                <button class="save-btn" onclick="saveDateSettings()">å„²å­˜</button>
              </div>
            `;
            
          case 'schedule':
            return `
              <div class="modal-header">
                <h3>è¡Œç¨‹è¨­å®š</h3>
                <button class="modal-close">Ã—</button>
              </div>
              <div class="modal-body">
                <div id="schedule-list">
                  ${appSettings.schedule.map((item, index) => `
                    <div class="schedule-row">
                      <input type="time" value="${item.time}" data-index="${index}" data-field="time">
                      <input type="text" value="${item.activity}" data-index="${index}" data-field="activity" placeholder="æ´»å‹•">
                      <button class="remove-btn" onclick="removeScheduleItem(${index})">Ã—</button>
                    </div>
                  `).join('')}
                </div>
                <button class="add-schedule-btn" onclick="addScheduleItem()">+ æ–°å¢è¡Œç¨‹</button>
              </div>
              <div class="modal-footer">
                <button class="save-btn" onclick="saveScheduleSettings()">å„²å­˜</button>
              </div>
            `;
            
          default:
            return `
              <div class="modal-header">
                <h3>${section}</h3>
                <button class="modal-close">Ã—</button>
              </div>
              <div class="modal-body">
                <p>åŠŸèƒ½é–‹ç™¼ä¸­...</p>
              </div>
            `;
        }
      }

      function bindModalEvents(section) {
        if (section === 'schedule') {
          document.addEventListener('input', function(e) {
            if (e.target.matches('input[data-index]')) {
              const index = parseInt(e.target.dataset.index);
              const field = e.target.dataset.field;
              if (appSettings.schedule[index]) {
                appSettings.schedule[index][field] = e.target.value;
              }
            }
          });
        }
      }

      function saveTitleSettings() {
        appSettings.title = document.getElementById('title-input').value;
        appSettings.subtitle = document.getElementById('subtitle-input').value;
        updatePreview();
        closeModal();
        showNotification('æ¨™é¡Œå·²æ›´æ–°');
      }

      function saveDateSettings() {
        appSettings.dateFrom = document.getElementById('date-from').value;
        appSettings.dateTo = document.getElementById('date-to').value;
        updatePreview();
        closeModal();
        showNotification('æ—¥æœŸå·²æ›´æ–°');
      }

      function saveScheduleSettings() {
        updatePreview();
        closeModal();
        showNotification('è¡Œç¨‹å·²æ›´æ–°');
      }

      function addScheduleItem() {
        appSettings.schedule.push({ time: '16:00', activity: 'æ–°æ´»å‹•' });
        const content = document.getElementById('modal-content');
        content.innerHTML = getModalContent('schedule');
        bindModalEvents('schedule');
      }

      function removeScheduleItem(index) {
        appSettings.schedule.splice(index, 1);
        const content = document.getElementById('modal-content');
        content.innerHTML = getModalContent('schedule');
        bindModalEvents('schedule');
      }

      function updatePreview() {
        // æ›´æ–°æ¨™é¡Œ
        document.getElementById('preview-title').textContent = appSettings.title;
        document.getElementById('preview-subtitle').textContent = appSettings.subtitle;
        
        // æ›´æ–°æ—¥æœŸé¡¯ç¤º
        if (appSettings.dateFrom) {
          const fromDate = new Date(appSettings.dateFrom);
          const toDate = new Date(appSettings.dateTo);
          const isSameDay = fromDate.toDateString() === toDate.toDateString();
          
          if (isSameDay) {
            document.getElementById('preview-date').textContent = 
              fromDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
          } else {
            const fromStr = fromDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
            const toStr = toDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
            document.getElementById('preview-date').textContent = `${fromStr} - ${toStr}`;
          }
        }
        
        // æ›´æ–°è¡Œç¨‹é è¦½
        const schedulePreview = document.getElementById('schedule-preview');
        if (appSettings.schedule.length > 0) {
          schedulePreview.innerHTML = appSettings.schedule.map(item => 
            `<div class="schedule-item">
              <span class="time">${item.time}</span>
              <span class="activity">${item.activity}</span>
            </div>`
          ).join('');
        } else {
          schedulePreview.innerHTML = '<div class="empty-state">No Schedule yet</div>';
        }
      }

      function publishChanges() {
        // é€™è£¡æœƒä¿å­˜åˆ° Firebase ä¸¦ç”Ÿæˆé€£çµ
        showNotification('è®Šæ›´å·²ç™¼å¸ƒï¼');
        console.log('ç™¼å¸ƒè¨­å®š:', appSettings);
      }

      function copyUserLink() {
        const userLink = `${window.location.origin}?room=${roomId}`;
        navigator.clipboard.writeText(userLink).then(() => {
          showNotification('ç”¨æˆ¶é€£çµå·²è¤‡è£½');
        });
      }

      function copyAdminLink() {
        const adminLink = `${window.location.origin}/admin.html?room=${roomId}`;
        navigator.clipboard.writeText(adminLink).then(() => {
          showNotification('ç®¡ç†é€£çµå·²è¤‡è£½');
        });
      }

      function showNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = message;
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #4CAF50;
          color: white;
          padding: 12px 20px;
          border-radius: 8px;
          z-index: 1000;
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.remove();
        }, 3000);
      }
    </script>
  </body>
</html>
